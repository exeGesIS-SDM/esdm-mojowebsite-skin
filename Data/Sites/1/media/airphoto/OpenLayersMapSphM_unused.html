<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="apple-mobile-web-app-capable" content="yes">

	<script src="http://openlayers.org/dev/OpenLayers.js"></script>
	<script src='http://dev.virtualearth.net/mapcontrol/mapcontrol.ashx?v=6.1'></script>
    
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.18/jquery-ui.min.js"></script>
	<link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.2/themes/base/jquery-ui.css" type="text/css" />

    <script type="text/javascript">
        var map, Aerials;
		var maxOpacity = 1.0;
        var minOpacity = 0.0;
		var initialOpacity = 0.9;
		// the extent the user cannot pan beyond
		var extent = new OpenLayers.Bounds(-190000,6726000,-165000,6738000);
        function init(){
            map = new OpenLayers.Map( {
				div: 'map',
                projection: new OpenLayers.Projection("EPSG:900913"),
				displayProjection: new OpenLayers.Projection("EPSG:4326"),
			    units: "m",
			    maxExtent: new OpenLayers.Bounds(-20037508.34, -20037508.34, 20037508.34, 20037508.34),
				restrictedExtent: extent,
			    controls: [new OpenLayers.Control.Navigation(),
			        new OpenLayers.Control.PanZoomBar()]
                  }
            );
            var BernersWMS100 = new OpenLayers.Layer.WMS(
                "UTM WMS Berners Allsop (UTM WMS)",
                "http://www.esdmwms.no-ip.co.uk/scripts/mapserv.exe?map=D:\\Websites\\UKBaseMap\\map\\AerialPhotos.map",
				{layers: 'Berners Allsop UTM', transparent: true, format: 'image/png'},
                {singleTile: true, isBaseLayer: false, opacity: 1.0
				}
            );
            var BernersWMStiled = new OpenLayers.Layer.WMS(
                "UTM WMS tiled Berners Allsop (UTM WMS tiled)",
                "http://www.esdmwms.no-ip.co.uk/scripts/mapserv.exe?map=D:\\Websites\\UKBaseMap\\map\\AerialPhotos.map",
				{layers: 'Berners Allsop UTM', transparent: true, format: 'image/png'},
                {singleTile: false, isBaseLayer: false, opacity: 1.0
				}
            );

			Aerials = new OpenLayers.Layer.TileCache( "Berners Allsop Photography",
                "http://www.esdmwms.no-ip.co.uk/scripts/tilecache/tilecache-2.11/Cache",
                "BernersAllsopSphMerc", 
				{'format': 'image/png',
				isBaseLayer: false, 
				serverResolutions: [19.109257068634033,9.554628534317016,4.777314267158508,2.388657133579254,1.194328566789627,0.5971642833948135,0.29858214169740677],
				opacity: initialOpacity,
				maxResolution: 25
				}
            );
			
			var OSM = new OpenLayers.Layer.OSM("OpenStreetMap");
			// create Virtual Earth layers
                OpenLayers.Layer.VirtualEarth.prototype.MAX_ZOOM_LEVEL=19;
                OpenLayers.Layer.VirtualEarth.prototype.RESOLUTIONS=OpenLayers.Layer.Google.prototype.RESOLUTIONS
                var veroad = new OpenLayers.Layer.VirtualEarth("Bing Maps Roads",
                    {'type': VEMapStyle.Road, 'sphericalMercator': true, numZoomLevels: 20});
                var veaer = new OpenLayers.Layer.VirtualEarth("Bing Maps Aerial",
                    {'type': VEMapStyle.Aerial, 'sphericalMercator': true, numZoomLevels: 20});
                var vehyb = new OpenLayers.Layer.VirtualEarth("Bing Maps Hybrid",
                    {'type': VEMapStyle.Hybrid, 'sphericalMercator': true, numZoomLevels: 20});

					
            map.addLayers([OSM, veroad, veaer, vehyb, Aerials]);
			BernersWMS100.setVisibility(false);
			BernersWMStiled.setVisibility(false);
            //map.zoomToMaxExtent();
			// Merthyr map.setCenter(new OpenLayers.LonLat(-377178, 6752084), 13);
			map.setCenter(new OpenLayers.LonLat(-178700, 6732000), 13);
            map.addControl(new OpenLayers.Control.LayerSwitcher());
			map.addControl(new OpenLayers.Control.MousePosition());
			map.addControl(new OpenLayers.Control.Scale());
            map.addControl(new OpenLayers.Control.ScaleLine());
			
			OSM.events.on({
                 moveend: function(e) {
                     if (e.zoomChanged) {
                       //showResolution();
                     }
                   }
			});
			veaer.events.on({
                 moveend: function(e) {
                     if (e.zoomChanged) {
                       //showResolution();
                     }
                   }
			});
			$("#amount").val(initialOpacity);
        }
        //function changeOpacity(byOpacity) {
        //    var newOpacity = (parseFloat(OpenLayers.Util.getElement('opacity').value) + byOpacity).toFixed(1);
        //    newOpacity = Math.min(maxOpacity,
        //                          Math.max(minOpacity, newOpacity));
        //    OpenLayers.Util.getElement('opacity').value = newOpacity;
        //    Aerials.setOpacity(newOpacity);
        //}

		function showResolution() {
		        	//alert(map.getResolution());
		        	 document.getElementById("res").innerHTML = map.getResolution();
        }


    </script>
    <script type="text/javascript">
        $(document).ready(function () {
            $("#slider").slider({
				value: initialOpacity,
				min: minOpacity,
				max: maxOpacity,
				step: 0.01,
				animate: true,
                slide: function (event, ui) {
                    setOpacity(ui.value);
                }
            });
        });

        function setOpacity(value) {
            $("#amount").val(value);
			Aerials.setOpacity(value);
        }
    </script>


	<style type="text/css">
        #map {
            width: 99%;
            height: 550px;
            border: 2px solid gray;
        }
		body {
			padding:0px;
			margin:2px
		}
    </style>
  </head>
  <body onload="init()">

    <div id="map"></div>

		<p id="res" style="display: none;">the res</p>
		<p style="margin-top: 0.2em; font-family: verdana; font-size:medium; float: left;">
			<label for="amount">Opacity of the aerial photographs:</label>
			<input type="text" id="amount" style="border:0; color:#f6931f; font-weight:bold; width: 4em;" />
		</p>

		<div id="slider" style="width: 160px;  float: left; margin-top: 0.3em;"></div>
  </body>
</html>


