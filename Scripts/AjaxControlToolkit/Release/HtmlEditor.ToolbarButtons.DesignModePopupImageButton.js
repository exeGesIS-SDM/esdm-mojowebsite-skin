Type.registerNamespace("Sys.Extended.UI.HtmlEditor.ToolbarButtons");Sys.Extended.UI.HtmlEditor.ToolbarButtons.DesignModePopupImageButton=function(n){Sys.Extended.UI.HtmlEditor.ToolbarButtons.DesignModePopupImageButton.initializeBase(this,[n]);this._relatedPopup=null;this._autoClose=!0;this._forclose_onmousedown$delegate=null};Sys.Extended.UI.HtmlEditor.ToolbarButtons.DesignModePopupImageButton.prototype={set_activeEditPanel:function(n){this._editPanel!=n&&this._editPanel!=null&&this.closePopup();Sys.Extended.UI.HtmlEditor.ToolbarButtons.DesignModePopupImageButton.callBaseMethod(this,"set_activeEditPanel",[n])},get_autoClose:function(){return this._autoClose},set_autoClose:function(n){this._autoClose=n},get_relatedPopup:function(){return this._relatedPopup},set_relatedPopup:function(n){this._relatedPopup=n},openPopup:function(n,t,i){var u,f;if((!this._autoClose||this._forclose_onmousedown$delegate==null)&&this._relatedPopup!=null){if(this._bookmark=null,Sys.Extended.UI.HtmlEditor.isIE)if(u=this._designPanel._getSelection(),this._selType=u.type.toLowerCase(),f=this._designPanel._createRange(u),this._selType=="text"||this._selType=="none")try{this._bookmark=f.duplicate()}catch(s){}else this._selType=="control"&&(this._bookmark=f.item(0),f.remove(0),u.empty());if(typeof this._relatedPopup.set_relatedElement=="function"){if(this._relatedPopup.set_relatedElement(this.get_element()),this._forclose_onmousedown$delegate=Function.createDelegate(this,this._forclose_onmousedown),this._autoClose){var e=this._designPanel.get_element().contentWindow,o=e.document.body,r=this;setTimeout(function(){r._forclose_onmousedown$delegate!=null&&(Sys.Extended.UI.HtmlEditor._addEvent(o,"mousedown",r._forclose_onmousedown$delegate),Sys.Extended.UI.HtmlEditor._addEvent(o,"keydown",r._forclose_onmousedown$delegate),Sys.Extended.UI.HtmlEditor._addEvent(document.body,"keydown",r._forclose_onmousedown$delegate),Sys.Extended.UI.HtmlEditor._addEvent(window,"keydown",r._forclose_onmousedown$delegate),Sys.Extended.UI.HtmlEditor._addEvent(e,"mousedown",r._forclose_onmousedown$delegate),Sys.Extended.UI.HtmlEditor._addEvent(document.body,"mousedown",r._forclose_onmousedown$delegate),document.documentElement&&Sys.Extended.UI.HtmlEditor._addEvent(document.documentElement,"mousedown",r._forclose_onmousedown$delegate))},0)}this._relatedPopup.open(n)}else this._relatedPopup.open(n,t,i)}},_forclose_onmousedown:function(n){var i,t,r,u,f;if(this._forclose_onmousedown$delegate==null)return!0;if(this._relatedPopup.isOpened)this._relatedPopup.close();else return!0;if(this._editPanel==Sys.Extended.UI.HtmlEditor.LastFocusedEditPanel)try{this._bookmark&&(Sys.Extended.UI.HtmlEditor.isIE&&(this._selType=="control"?(t=this._designPanel._doc.body.createControlRange(),t.add(this._bookmark)):t=this._bookmark,t.select()),this._bookmark=null);Sys.Extended.UI.HtmlEditor.isIE||(i=this._designPanel._getSelection(),t=this._designPanel._createRange(i),this._designPanel._removeAllRanges(i),this._designPanel._selectRange(i,t),this._designPanel.focusEditor())}catch(e){}if(r=this,setTimeout(function(){if(r._editPanel==Sys.Extended.UI.HtmlEditor.LastFocusedEditPanel)try{r._editPanel.updateToolbar()}catch(n){}},0),this._autoClose)try{u=this._designPanel.get_element().contentWindow;f=u.document.body;document.documentElement&&Sys.Extended.UI.HtmlEditor._removeEvent(document.documentElement,"mousedown",this._forclose_onmousedown$delegate);Sys.Extended.UI.HtmlEditor._removeEvent(f,"keydown",this._forclose_onmousedown$delegate);Sys.Extended.UI.HtmlEditor._removeEvent(document.body,"keydown",this._forclose_onmousedown$delegate);Sys.Extended.UI.HtmlEditor._removeEvent(window,"keydown",this._forclose_onmousedown$delegate);Sys.Extended.UI.HtmlEditor._removeEvent(f,"mousedown",this._forclose_onmousedown$delegate);Sys.Extended.UI.HtmlEditor._removeEvent(u,"mousedown",this._forclose_onmousedown$delegate);Sys.Extended.UI.HtmlEditor._removeEvent(document.body,"mousedown",this._forclose_onmousedown$delegate)}catch(e){}return(this._forclose_onmousedown$delegate=null,n&&n.type&&n.type=="keydown")?(Sys.Extended.UI.HtmlEditor._stopEvent(n),!1):!0},closePopup:function(){this._forclose_onmousedown$delegate!=null&&this._forclose_onmousedown$delegate(null)},dispose:function(){this._forclose_onmousedown$delegate!=null&&this._forclose_onmousedown$delegate(null);Sys.Extended.UI.HtmlEditor.ToolbarButtons.DesignModePopupImageButton.callBaseMethod(this,"dispose")}};Sys.Extended.UI.HtmlEditor.ToolbarButtons.DesignModePopupImageButton.registerClass("Sys.Extended.UI.HtmlEditor.ToolbarButtons.DesignModePopupImageButton",Sys.Extended.UI.HtmlEditor.ToolbarButtons.MethodButton);